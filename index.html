<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>Tube Bend Length Calculator — CAD-stijl</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    background:#0f172a; color:#e5e7eb;
    font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    margin:0; padding:0;
  }
  header { padding:16px 24px; border-bottom:1px solid #1f2937; }
  h1 { margin:0 0 4px; font-size:20px; }
  main {
    display:grid; grid-template-columns:360px 1fr;
    gap:18px; padding:16px;
  }
  .card {
    background:#111827; padding:16px;
    border-radius:10px;
    box-shadow:0 0 0 1px #1e293b inset;
  }
  label { font-weight:600; }
  input, select {
    width:100%; padding:8px; margin-top:4px;
    background:#0b1020; color:#e5e7eb;
    border:1px solid #334155; border-radius:6px;
  }
  button {
    padding:8px 12px; border:none; border-radius:6px;
    font-weight:700; cursor:pointer;
  }
  button.add { background:#38bdf8; color:#041f2e; }
  button.sec { background:#1e293b; color:#e5e7eb; border:1px solid #334155; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th,td { padding:6px; border-bottom:1px solid #1e293b; }
  .chip { background:#0b1020; border:1px solid #334155; padding:4px 8px; border-radius:999px; }
  .ok { color:#86efac; }
  .err { color:#fca5a5; }
  svg { background:#0b1020; border-radius:10px; width:100%; height:520px; }
</style>
</head>
<body>

<header>
  <h1>Tube Bend Length Calculator — CAD-stijl</h1>
  <small>Berekening: som(rechte stukken) – som(Swagelok bend adjustments). SVG is schematisch.</small>
</header>

<main>

<!-- LEFT: UI -->
<section class="card">
  <h3>Instellingen</h3>

  <label>Buis OD (inch)</label>
  <select id="odSel">
    <option value="1/2">1/2"</option>
    <option value="3/8">3/8"</option>
  </select>

  <div style="margin-top:12px;">
    <label>Vaste radius (mm, alleen voor SVG)</label>
    <div id="radiusMM" class="chip"></div>
  </div>

  <hr style="border-color:#1e293b; margin:16px 0;">

  <h3>Segmenten</h3>
  <div id="segments"></div>

  <button class="add" id="addSeg">+ Segment toevoegen</button>
  <button class="sec" id="clearSeg">Alles wissen</button>

  <hr style="border-color:#1e293b; margin:16px 0;">

  <h3>Resultaat</h3>
  <p>Σ rechte stukken: <span id="sumStraight" class="chip"></span></p>
  <p>Σ bend gains: <span id="sumGain" class="chip"></span></p>
  <p><b>TOTALE LENGTE:</b> <span id="totalLen" class="chip"></span></p>

  <div id="status" style="margin-top:12px;"></div>

  <hr style="border-color:#1e293b; margin:16px 0;">

  <button class="sec" id="csvBtn">Download CSV</button>
</section>



<!-- RIGHT: SVG -->
<section class="card">
  <h3>Schematische weergave</h3>
  <svg id="svg" viewBox="0 0 900 520">
    <rect x="0" y="0" width="900" height="520" fill="#0b1020"/>
    <g id="draw" transform="translate(40,260)"></g>
  </svg>
</section>

</main>

<script>
/* ---------- CONFIG ---------- */

const INCH = 25.4;

const RADIUS = {
  "1/2": 1.5 * INCH,   // 1.5" Swagelok bender
  "3/8": 0.9375 * INCH // 15/16"
};

// Gains per angle per OD (in inches)
const GAIN = {
  "1/2": {
    0:0, 22.5:0, 30:1/16, 45:1/16, 50:1/8, 55:1/8, 60:3/16,
    65:1/4, 70:5/16, 75:3/8, 80:7/16, 85:9/16, 90:11/16
  },
  "3/8": {
    0:0, 22.5:0, 30:0, 45:1/16, 50:1/16, 55:1/8, 60:1/8,
    65:1/8, 70:3/16, 75:1/4, 80:5/16, 85:3/8, 90:7/16
  }
};

/* ---------- STATE ---------- */

let segments = []; 
// segment = { len: mm, angle: deg, dir:'L'|'R'|null }

/* ---------- HELPERS ---------- */

const round = (x)=>Math.round(x*10)/10;
const el = (tag)=>document.createElement(tag);

/* ---------- UI BUILD ---------- */

function renderSegments(){
  const wrap = document.getElementById("segments");
  wrap.innerHTML = "";

  segments.forEach((s,i)=>{
    const div = el("div");
    div.style.marginBottom = "12px";
    div.style.padding = "10px";
    div.style.border = "1px solid #334155";
    div.style.borderRadius = "6px";

    div.innerHTML = `
      <b>S${i+1}</b><br>
      <label>Lengte (mm)</label>
      <input type="number" step="0.1" value="${s.len}" data-idx="${i}" data-field="len">
      <label style="margin-top:6px;">Hoek na segment</label>
      <select data-idx="${i}" data-field="angle">
        ${[0,22.5,30,45,50,55,60,65,70,75,80,85,90]
          .map(a=>`<option ${a==s.angle?'selected':''}>${a}</option>`).join("")}
      </select>
      <label style="margin-top:6px;">Richting</label>
      <select data-idx="${i}" data-field="dir">
        <option value="" ${s.dir==null?'selected':''}>—</option>
        <option value="L" ${s.dir=="L"?'selected':''}>Left</option>
        <option value="R" ${s.dir=="R"?'selected':''}>Right</option>
      </select>
      <button class="sec" data-del="${i}" style="margin-top:6px;">Verwijder</button>
    `;
    wrap.appendChild(div);
  });

  wrap.querySelectorAll("input,select").forEach(inp=>{
    inp.onchange = ()=>{
      const i = Number(inp.dataset.idx);
      const f = inp.dataset.field;
      if(f==="len") segments[i].len = Number(inp.value);
      else if(f==="angle") segments[i].angle = Number(inp.value);
      else if(f==="dir") segments[i].dir = inp.value || null;
      calc();
    };
  });

  wrap.querySelectorAll("[data-del]").forEach(btn=>{
    btn.onclick = ()=>{
      const i = Number(btn.dataset.del);
      segments.splice(i,1);
      renderSegments(); calc();
    };
  });
}

/* ---------- MATH: TOTAL LENGTH ---------- */

function calc(){
  const od = document.getElementById("odSel").value;

  // straight sum
  const sumStraight = segments.reduce((a,s)=>a+s.len,0);

  // gain sum
  let sumGain = 0;
  segments.forEach(s=>{
    const g = GAIN[od][s.angle] || 0;
    sumGain += g * INCH; // inch -> mm
  });

  const total = sumStraight - sumGain;

  document.getElementById("sumStraight").textContent = round(sumStraight)+" mm";
  document.getElementById("sumGain").textContent = round(sumGain)+" mm";
  document.getElementById("totalLen").textContent = round(total)+" mm";

  document.getElementById("status").innerHTML =
    `<span class="ok">Berekening OK. Totale lengte = ${round(total)} mm.</span>`;

  drawSVG();
}

/* ---------- SVG ---------- */

function drawSVG(){
  const od = document.getElementById("odSel").value;
  const R = RADIUS[od];
  const Rpx = R * 0.6; // visuele schaal

  const g = document.getElementById("draw");
  g.innerHTML = "";

  let x = 0, y = 0;
  let angleDir = 0;

  const pathCmds = [`M ${x} ${y}`];

  segments.forEach((s,i)=>{
    // Rechte lijn
    const dx = s.len * 0.6 * Math.cos(angleDir);
    const dy = s.len * 0.6 * Math.sin(angleDir);
    x += dx; y += dy;
    pathCmds.push(`L ${x} ${y}`);

    // Label P's (P1, P2, ...)
    const lab = el("text");
    lab.setAttribute("x", x+4);
    lab.setAttribute("y", y-4);
    lab.setAttribute("fill","#38bdf8");
    lab.setAttribute("font-size","12");
    lab.textContent = "P"+(i+1);
    g.appendChild(lab);

    // Arc tekenen (schematisch)
    if(s.angle>0){
      const theta = s.angle * Math.PI/180;
      const cw = s.dir=="R" ? 1 : 0;

      const dxA = Rpx * Math.sin(theta);
      const dyA = Rpx * (1 - Math.cos(theta));
      const x2 = cw ? x+dxA : x+dxA;
      const y2 = cw ? y+dyA : y-dyA;

      pathCmds.push(`A ${Rpx} ${Rpx} 0 0 ${cw} ${x2} ${y2}`);
      x = x2; y = y2;

      // rotatierichting bijhouden (schets)
      angleDir += (cw?1:-1)*theta;
    }
  });

  const p = document.createElementNS("http://www.w3.org/2000/svg","path");
  p.setAttribute("d", pathCmds.join(" "));
  p.setAttribute("stroke","#38bdf8");
  p.setAttribute("stroke-width","2");
  p.setAttribute("fill","none");
  g.appendChild(p);
}

/* ---------- CSV ---------- */

document.getElementById("csvBtn").onclick = ()=>{
  let rows = [["Segment","Length mm","Angle","Direction"]];
  segments.forEach((s,i)=>{
    rows.push([`S${i+1}`, s.len, s.angle, s.dir || ""]);
  });

  const csv = rows.map(r=>r.join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = el("a");
  a.href = url; a.download = "tube_segments.csv";
  a.click();
  URL.revokeObjectURL(url);
};

/* ---------- EVENTS ---------- */

document.getElementById("addSeg").onclick = ()=>{
  segments.push({ len:100, angle:0, dir:null });
  renderSegments(); calc();
};

document.getElementById("clearSeg").onclick = ()=>{
  segments = [];
  renderSegments(); calc();
};

document.getElementById("odSel").onchange = ()=>{
  document.getElementById("radiusMM").textContent =
    round(RADIUS[document.getElementById("odSel").value],1)+" mm";
  calc();
};

/* ---------- INIT ---------- */

document.getElementById("radiusMM").textContent =
  round(RADIUS["1/2"],1)+" mm";

// voorbeeld zoals jouw tekening
segments = [
  { len:165, angle:90, dir:"R" },
  { len:100, angle:90, dir:"L" },
  { len:185, angle:0,  dir:null }
];

renderSegments();
calc();

</script>
</body>
</html>
